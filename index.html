<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello Analytics Reporting API V4</title>
  <meta name="google-signin-client_id" content="515465435162-mqrovgo9cvfnb1otbgidl2bmhqgdm0do.apps.googleusercontent.com">
  <meta name="google-signin-scope" content="https://www.googleapis.com/auth/analytics.readonly">
  <!-- Google Analytics -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-123730979-1', 'auto');
    ga('send', 'pageview');
  </script>

  <script>
    (function (w, d, s, g, js, fjs) {
      g = w.gapi || (w.gapi = {});
      g.analytics = {
        q: [],
        ready: function (cb) {
          this.q.push(cb)
        }
      };
      js = d.createElement(s);
      fjs = d.getElementsByTagName(s)[0];
      js.src = 'https://apis.google.com/js/platform.js';
      fjs.parentNode.insertBefore(js, fjs);
      js.onload = function () {
        g.load('analytics')
      };
    }(window, document, 'script'));
  </script>
  <!-- End Google Analytics -->
</head>

<body>
  <h1>Hello Analytics Reporting API V4 & Embed API</h1>
  <section id="auth-button"></section>

  <div id="active-users-container"></div>

  <section id="view-selector"></section>
  <section id="timeline"></section>

  <h4>Browser</h4>
  <div id="view-selector-1-container"></div>
  <div id="chart-1-container"></div>

  <h4>Mobile Device Info</h4>
  <div id="view-selector-2-container"></div>
  <div id="chart-2-container"></div>

  <!-- Include the ActiveUsers component script. -->
  <script src="./active-users.js"></script>
  <script>
    gapi.analytics.ready(function () {

      // Step 3: Authorize the user.

      var CLIENT_ID = '515465435162-mqrovgo9cvfnb1otbgidl2bmhqgdm0do.apps.googleusercontent.com';

      gapi.analytics.auth.authorize({
        container: 'auth-button',
        clientid: CLIENT_ID,
      });


      /**
       * Create a new ActiveUsers instance to be rendered inside of an
       * element with the id "active-users-container" and poll for changes every
       * five seconds.
       */
      var activeUsers = new gapi.analytics.ext.ActiveUsers({
        container: 'active-users-container',
        pollingInterval: 5
      });

      // Step 4: Create the view selector.

      var viewSelector = new gapi.analytics.ViewSelector({
        container: 'view-selector'
      });

      // Step 5: Create the timeline chart.

      var timeline = new gapi.analytics.googleCharts.DataChart({
        reportType: 'ga',
        query: {
          'dimensions': 'ga:date',
          'metrics': 'ga:sessions',
          'start-date': '30daysAgo',
          'end-date': 'yesterday',
        },
        chart: {
          type: 'LINE',
          container: 'timeline'
        }
      });

      /**
       * Create a ViewSelector for the first view to be rendered inside of an
       * element with the id "view-selector-1-container".
       */
      var viewSelector1 = new gapi.analytics.ViewSelector({
        container: 'view-selector-1-container'
      });

      /**
       * Create the first DataChart for top countries over the past 30 days.
       * It will be rendered inside an element with the id "chart-1-container".
       */
      var dataChart1 = new gapi.analytics.googleCharts.DataChart({
        query: {
          metrics: 'ga:sessions',
          dimensions: 'ga:browser',
          'start-date': '30daysAgo',
          'end-date': 'yesterday',
          'max-results': 6,
          sort: '-ga:sessions'
        },
        chart: {
          container: 'chart-1-container',
          type: 'PIE',
          options: {
            width: '100%',
            pieHole: 4 / 9
          }
        }
      });

      var viewSelector2 = new gapi.analytics.ViewSelector({
        container: 'view-selector-2-container'
      });

      var dataChart2 = new gapi.analytics.googleCharts.DataChart({
        query: {
          metrics: 'ga:sessions',
          dimensions: 'ga:mobileDeviceInfo',
          'start-date': '30daysAgo',
          'end-date': 'yesterday',
          'max-results': 6,
          sort: '-ga:sessions'
        },
        chart: {
          container: 'chart-2-container',
          type: 'PIE',
          options: {
            width: '100%',
            pieHole: 4 / 9
          }
        }
      });

      // Step 6: Hook up the components to work together.

      gapi.analytics.auth.on('success', function (response) {
        // Start tracking active users for this view.
        activeUsers.set(data).execute();

        viewSelector.execute();
        viewSelector1.execute();
        viewSelector2.execute();
      });

      viewSelector.on('change', function (ids) {
        var newIds = {
          query: {
            ids: ids
          }
        }
        timeline.set(newIds).execute();
      });

      /**
       * Update the first dataChart when the first view selecter is changed.
       */
      viewSelector1.on('change', function (ids) {
        dataChart1.set({
          query: {
            ids: ids
          }
        }).execute();
      });

      viewSelector2.on('change', function (ids) {
        dataChart2.set({
          query: {
            ids: ids
          }
        }).execute();
      });
    });
  </script>
</body>

</html>